{
  "project": "Riassu.mi",
  "branchName": "ralph/pdf-study-summarizer",
  "description": "Web app per riassumere PDF di studio con AI e generare quiz di verifica. Supporta multiple API key OpenRouter con failover automatico.",
  "userStories": [
    {
      "id": "US-001",
      "title": "Setup progetto Next.js",
      "description": "Come sviluppatore, ho bisogno della struttura base del progetto Next.js per iniziare lo sviluppo.",
      "acceptanceCriteria": [
        "Inizializzare progetto Next.js 14+ con App Router",
        "Configurare TypeScript",
        "Configurare Tailwind CSS",
        "Creare struttura cartelle: app/, components/, lib/, types/",
        "Typecheck passa"
      ],
      "priority": 1,
      "passes": true,
      "notes": "Completed: Next.js 16.1.4 with App Router, TypeScript 5, Tailwind CSS 4. Folder structure created with app/, components/, lib/, types/. Typecheck passes."
    },
    {
      "id": "US-002",
      "title": "Setup Prisma con schema base",
      "description": "Come sviluppatore, ho bisogno del database SQLite con Prisma ORM configurato.",
      "acceptanceCriteria": [
        "Installare Prisma e configurare SQLite",
        "Creare schema User: id, email, password_hash, created_at",
        "Creare schema Summary: id, user_id (nullable), title, content, detail_level, pdf_name, created_at",
        "Creare schema Quiz: id, summary_id, questions (JSON), created_at",
        "Creare schema ApiKey: id, key_encrypted, provider, is_active, last_used, fail_count, disabled_until",
        "Eseguire migration con successo",
        "Typecheck passa"
      ],
      "priority": 2,
      "passes": true,
      "notes": "Completed: Prisma 7.3.0 with SQLite via better-sqlite3 adapter. All models created: User, Summary, Quiz, ApiKey. Migration successful. Prisma client generated to lib/generated/prisma/. Typecheck passes."
    },
    {
      "id": "US-003",
      "title": "Servizio gestione API key con failover",
      "description": "Come sviluppatore, ho bisogno di un servizio che gestisca multiple API key con failover automatico.",
      "acceptanceCriteria": [
        "Creare lib/api-keys.ts con funzioni: getActiveKey(), markKeyFailed(), markKeySuccess()",
        "getActiveKey() ritorna la prima key attiva non disabilitata",
        "markKeyFailed() incrementa fail_count e disabilita per 1 ora se fail_count > 5",
        "Criptazione/decriptazione key con crypto di Node.js",
        "Chiave di criptazione letta da variabile ambiente ENCRYPTION_KEY",
        "Typecheck passa"
      ],
      "priority": 3,
      "passes": true,
      "notes": "Completed: Created lib/api-keys.ts with AES-256-GCM encryption. Functions implemented: getActiveKey(), getActiveKeyWithId(), markKeyFailed(), markKeySuccess(), encryptKey(), decryptKey(), addApiKey(), deactivateKey(), reactivateKey(). Keys are disabled for 1 hour after >5 failures. ENCRYPTION_KEY read from environment. Typecheck passes."
    },
    {
      "id": "US-004",
      "title": "Componenti UI base",
      "description": "Come sviluppatore, ho bisogno dei componenti UI riutilizzabili per costruire l'interfaccia.",
      "acceptanceCriteria": [
        "Creare components/ui/button.tsx con varianti: primary, secondary, ghost",
        "Creare components/ui/card.tsx per contenitori",
        "Creare components/ui/input.tsx per campi testo",
        "Creare components/ui/select.tsx per dropdown",
        "Creare components/ui/spinner.tsx per loading",
        "Tutti i componenti usano Tailwind CSS",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 4,
      "passes": true,
      "notes": "Completed: Created all UI components in components/ui/. Button has primary/secondary/ghost variants. Card includes CardHeader/CardContent/CardFooter subcomponents. Input and Select support labels and error states. Spinner has sm/md/lg sizes. All components use Tailwind CSS and are typed with forwardRef. Index file created for easy imports. Typecheck passes."
    },
    {
      "id": "US-005",
      "title": "Homepage con hero section",
      "description": "Come visitatore, voglio vedere una homepage che spiega cosa fa l'app.",
      "acceptanceCriteria": [
        "Hero section con titolo 'Riassu.mi' e descrizione breve",
        "Pulsante CTA 'Carica PDF' che porta a /upload",
        "Sezione 'Come funziona' con 3 step: Carica, Riassumi, Quiz",
        "Design responsive mobile-first",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 5,
      "passes": true,
      "notes": "Completed: Created responsive homepage with hero section featuring 'Riassu.mi' title and AI-powered description. CTA button links to /upload. 'Come funziona' section with 3 steps: Carica (upload), Riassumi (AI summary), Quiz (test knowledge). Mobile-first responsive design with Tailwind CSS. Updated app metadata. Typecheck passes."
    },
    {
      "id": "US-006",
      "title": "Upload PDF con drag & drop",
      "description": "Come studente, voglio caricare un PDF tramite drag & drop o click.",
      "acceptanceCriteria": [
        "Creare pagina /upload con componente FileUpload",
        "Supporto drag & drop e click per selezionare file",
        "Validazione: solo file .pdf, max 20MB",
        "Mostra nome file e dimensione dopo selezione",
        "Messaggio errore se file non valido",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 6,
      "passes": true,
      "notes": "Completed: Created /upload page with FileUpload component. Features: drag & drop with visual feedback, click to select file, .pdf validation with MIME type check, 20MB size limit, displays file name and formatted size, error messages for invalid files, clear file button. Mobile-first responsive design. Typecheck passes."
    },
    {
      "id": "US-007",
      "title": "Estrazione testo da PDF",
      "description": "Come sviluppatore, ho bisogno di estrarre il testo dal PDF caricato.",
      "acceptanceCriteria": [
        "Installare e configurare pdf-parse",
        "Creare lib/pdf-parser.ts con funzione extractText(buffer, excludePages?)",
        "La funzione ritorna array di { pageNumber, text } per ogni pagina",
        "Supporto esclusione pagine tramite parametro excludePages (es. [1,2,3,15])",
        "Gestione errore se PDF non contiene testo estraibile",
        "Typecheck passa"
      ],
      "priority": 7,
      "passes": true,
      "notes": "Completed: Installed pdf-parse 2.4.5 with TypeScript types. Created lib/pdf-parser.ts with extractText(buffer, excludePages?) function that returns array of {pageNumber, text}. Added extractTextWithInfo() for getting total page count. Added getPageCount() utility. PDFExtractionError class for error handling. Excludes pages via the partial parameter. Typecheck passes."
    },
    {
      "id": "US-008",
      "title": "Input selezione pagine da escludere",
      "description": "Come studente, voglio specificare quali pagine saltare dal riassunto.",
      "acceptanceCriteria": [
        "Aggiungere input testuale nella pagina /upload",
        "Formato accettato: '1-3, 5, 10-15' (range e singole pagine)",
        "Validazione formato con messaggio errore se invalido",
        "Funzione parsePageRanges() in lib/utils.ts che converte stringa in array numeri",
        "Preview: mostra 'Pagine escluse: X' e 'Pagine da processare: Y'",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 8,
      "passes": true,
      "notes": "Completed: Added page exclusion input to /upload page. Input accepts format '1-3, 5, 10-15' with real-time validation. parsePageRanges() function was already in lib/utils.ts. Preview shows 'Pagine escluse: X' and 'Pagine da processare: Y' with list of excluded pages. Uses pdf-lib for client-side PDF page count extraction. Validation includes max page check. Typecheck passes."
    },
    {
      "id": "US-009",
      "title": "Selector livello dettaglio riassunto",
      "description": "Come studente, voglio scegliere quanto dettagliato deve essere il riassunto.",
      "acceptanceCriteria": [
        "Aggiungere select con 3 opzioni nella pagina /upload: Breve, Medio, Dettagliato",
        "Tooltip/descrizione per ogni opzione che spiega cosa aspettarsi",
        "Breve: 'Bullet points dei concetti chiave'",
        "Medio: '1-2 paragrafi per sezione'",
        "Dettagliato: 'Spiegazioni complete con esempi'",
        "Default selezionato: Medio",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 9,
      "passes": true,
      "notes": "Completed: Created DetailLevelSelector component with radio-button style cards showing 3 options (Breve, Medio, Dettagliato). Each option displays its description visibly. Default is 'Medio'. Component integrated into /upload page, state managed with useState. Responsive design with grid layout. Typecheck passes."
    },
    {
      "id": "US-010",
      "title": "Servizio OpenRouter per riassunti",
      "description": "Come sviluppatore, ho bisogno di un servizio che chiami OpenRouter per generare riassunti.",
      "acceptanceCriteria": [
        "Creare lib/openrouter.ts con funzione generateSummary(text, detailLevel)",
        "Usare modello gratuito: meta-llama/llama-3.2-3b-instruct:free",
        "Prompt diverso per ogni livello di dettaglio",
        "Integrazione con servizio API key per failover automatico",
        "Se API call fallisce, markKeyFailed() e riprova con altra key",
        "Ritorna riassunto in formato Markdown",
        "Typecheck passa"
      ],
      "priority": 10,
      "passes": true,
      "notes": "Completed: Created lib/openrouter.ts with generateSummary(text, detailLevel) function. Uses meta-llama/llama-3.2-3b-instruct:free model. Three different Italian prompts for brief/medium/detailed levels. Integrated with API key failover: getActiveKeyWithId(), markKeyFailed(), markKeySuccess(). Max 3 retries with automatic key rotation on 401/429/402 errors. Returns Markdown-formatted summary. OpenRouterError class for error handling. Typecheck passes."
    },
    {
      "id": "US-011",
      "title": "Chunking per PDF lunghi",
      "description": "Come sviluppatore, ho bisogno di gestire PDF che superano il context window dell'AI.",
      "acceptanceCriteria": [
        "Creare funzione chunkText(text, maxTokens) in lib/openrouter.ts",
        "Dividere testo in chunk di ~3000 token (sicuro per modelli free)",
        "Generare riassunto per ogni chunk",
        "Combinare riassunti parziali in riassunto finale",
        "Typecheck passa"
      ],
      "priority": 11,
      "passes": true,
      "notes": "Completed: Created chunkText(text, maxTokens) function with smart splitting (paragraphs > sentences > words). Added estimateTokens() for token estimation (~4 chars/token). Created generateSummaryWithChunking() that: 1) splits text into ~3000 token chunks, 2) generates summary for each chunk with progress callback, 3) combines partial summaries using AI or returns concatenated version as fallback. ChunkProgressCallback type exported for UI progress tracking. Typecheck passes."
    },
    {
      "id": "US-012",
      "title": "API route per generazione riassunto",
      "description": "Come sviluppatore, ho bisogno di un endpoint API per processare il PDF e generare il riassunto.",
      "acceptanceCriteria": [
        "Creare app/api/summarize/route.ts",
        "Accetta POST con: file PDF (FormData), excludePages (string), detailLevel (string)",
        "Estrae testo dal PDF escludendo pagine specificate",
        "Chiama OpenRouter per generare riassunto",
        "Salva Summary nel database (user_id null per guest)",
        "Ritorna JSON con summaryId e content",
        "Typecheck passa"
      ],
      "priority": 12,
      "passes": true,
      "notes": "Completed: Created app/api/summarize/route.ts with POST endpoint. Accepts FormData with file (PDF), excludePages (optional string), and detailLevel (required: brief/medium/detailed). Validates file type (.pdf), size (max 20MB), and detail level. Uses pdf-parser to extract text with page exclusion support. Calls generateSummaryWithChunking for AI summary generation with automatic chunking for long PDFs. Saves Summary to database with user_id null for guest users. Returns JSON {summaryId, content}. Proper error handling with user-friendly Italian messages. Typecheck passes."
    },
    {
      "id": "US-013",
      "title": "Pagina risultato riassunto",
      "description": "Come studente, voglio vedere il riassunto generato in una pagina dedicata.",
      "acceptanceCriteria": [
        "Creare pagina /summary/[id] che mostra il riassunto",
        "Rendering Markdown con formattazione (titoli, liste, grassetto)",
        "Mostra titolo PDF e livello dettaglio usato",
        "Pulsante 'Genera Quiz' per procedere al quiz",
        "Pulsante 'Scarica PDF' per download",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 13,
      "passes": true,
      "notes": "Completed: Created /summary/[id] dynamic route page. Server component fetches summary from database, displays PDF title, detail level (with Italian labels), and creation date. Uses react-markdown for Markdown rendering with custom styled components for headings, paragraphs, lists, blockquotes, code blocks. 'Genera Quiz' button links to /quiz/generate/[summaryId]. 'Scarica PDF' button placeholder (full implementation in US-019). Responsive design with dark mode support. Typecheck passes."
    },
    {
      "id": "US-014",
      "title": "Progress indicator durante generazione",
      "description": "Come studente, voglio vedere un indicatore di progresso mentre il riassunto viene generato.",
      "acceptanceCriteria": [
        "Mostrare spinner con messaggio 'Analizzando il PDF...'",
        "Aggiornare messaggio: 'Generando riassunto...'",
        "Se chunking: mostrare 'Elaborando parte X di Y...'",
        "Animazione fluida senza blocchi UI",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 14,
      "passes": true,
      "notes": "Completed: Created ProgressIndicator component in components/progress-indicator.tsx. Shows different stages: analyzing, generating, chunking (with progress bar), saving. Integrated into /upload page - replaces form with progress UI during API call. Shows error messages on failure. Stage transitions: Analyzing (1.5s) -> Generating -> Saving -> redirect to summary. Spinner with pulsing animation. Chunk progress shows percentage and progress bar. Helpful tip shown during processing. Typecheck passes."
    },
    {
      "id": "US-015",
      "title": "Servizio generazione quiz",
      "description": "Come sviluppatore, ho bisogno di generare quiz basati sul riassunto.",
      "acceptanceCriteria": [
        "Creare funzione generateQuiz(summaryContent) in lib/openrouter.ts",
        "Generare 10 domande: ~7 multiple choice (4 opzioni), ~3 vero/falso",
        "Output JSON: array di { question, type, options?, correctAnswer, explanation }",
        "Prompt che richiede domande nella lingua del contenuto",
        "Integrazione failover API key",
        "Typecheck passa"
      ],
      "priority": 15,
      "passes": true,
      "notes": "Completed: Created generateQuiz(summaryContent) function in lib/openrouter.ts. Generates 10 questions: ~7 multiple choice (4 options each) and ~3 true/false. Returns array of QuizQuestion objects with question, type, options (for MC), correctAnswer, explanation. Italian system prompt requests questions in content language. Includes robust JSON parsing with markdown code block handling. API key failover integrated with retry on auth/rate limit errors. QuizQuestion and QuizQuestionType types exported. Typecheck passes."
    },
    {
      "id": "US-016",
      "title": "API route per generazione quiz",
      "description": "Come sviluppatore, ho bisogno di un endpoint API per generare il quiz.",
      "acceptanceCriteria": [
        "Creare app/api/quiz/route.ts",
        "Accetta POST con: summaryId",
        "Recupera summary dal database",
        "Chiama generateQuiz() con il contenuto",
        "Salva Quiz nel database collegato al Summary",
        "Ritorna JSON con quizId e questions",
        "Typecheck passa"
      ],
      "priority": 16,
      "passes": true,
      "notes": "Completed: Created app/api/quiz/route.ts with POST endpoint. Accepts JSON body with summaryId parameter. Fetches summary from database using Prisma, validates content length (min 100 chars). Calls generateQuiz() from lib/openrouter.ts to generate 10 questions. Saves Quiz to database with questions as JSON string. Returns {quizId, questions} on success. Proper error handling with Italian messages for invalid requests (400), not found (404), and server errors (500). Typecheck passes."
    },
    {
      "id": "US-017",
      "title": "Interfaccia quiz interattivo",
      "description": "Come studente, voglio completare il quiz una domanda alla volta.",
      "acceptanceCriteria": [
        "Creare pagina /quiz/[id] con interfaccia quiz",
        "Mostra una domanda alla volta con numero (1/10)",
        "Per multiple choice: 4 pulsanti opzione",
        "Per vero/falso: 2 pulsanti Vero/Falso",
        "Selezione risposta evidenziata visivamente",
        "Navigazione: pulsanti Indietro/Avanti",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 17,
      "passes": true,
      "notes": "Completed: Created /quiz/generate/[summaryId] page that calls quiz API and redirects to quiz page. Created /quiz/[id] page with server component (page.tsx) and client component (quiz-interface.tsx). Features: one question at a time with progress bar, question number (1/10), multiple choice with 4 options (A/B/C/D labels), true/false with Vero/Falso buttons, visual highlighting of selected answer, Indietro/Avanti navigation buttons, dot navigation to jump between questions, answered questions shown in green. Verifica Risposte button visible on last question (disabled until all answered). Responsive design with dark mode support. Typecheck passes."
    },
    {
      "id": "US-018",
      "title": "Schermata risultati quiz",
      "description": "Come studente, voglio vedere il mio punteggio e le risposte corrette.",
      "acceptanceCriteria": [
        "Pulsante 'Verifica Risposte' visibile dopo aver risposto a tutte le domande",
        "Schermata risultati con punteggio X/10",
        "Lista domande con indicatore verde (corretta) o rosso (sbagliata)",
        "Per ogni errore: mostra risposta data, risposta corretta, spiegazione",
        "Pulsante 'Ripeti Quiz' per ricominciare",
        "Pulsante 'Torna al Riassunto'",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 18,
      "passes": true,
      "notes": "Completed: Created /quiz/[id]/results page with server component (page.tsx) and client component (quiz-results.tsx). Features: score display X/10 with percentage, color-coded feedback based on performance (green >=80%, yellow >=60%, red <60%), question list with green/red left border and checkmark/X icons, user answer shown for each question, correct answer and explanation shown only for incorrect answers, 'Ripeti Quiz' button links back to quiz page, 'Torna al Riassunto' button links to summary page. Responsive design with dark mode support. Typecheck passes."
    },
    {
      "id": "US-019",
      "title": "Download riassunto come PDF",
      "description": "Come studente, voglio scaricare il riassunto in formato PDF.",
      "acceptanceCriteria": [
        "Installare jspdf per generazione PDF client-side",
        "Pulsante 'Scarica Riassunto' nella pagina /summary/[id]",
        "PDF include: titolo, data, livello dettaglio, contenuto formattato",
        "Nome file: riassunto-[titolo]-[data].pdf",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 19,
      "passes": true,
      "notes": "Completed: Installed jspdf 3.x for client-side PDF generation. Created lib/pdf-generator.ts with generateSummaryPdf() function that converts Markdown to plain text and generates formatted A4 PDF. PDF includes: title, file name, detail level (in Italian), creation date, formatted content with headers and bullet points, and page numbers. File named riassunto-[sanitized-title]-[date].pdf. Updated summary-content.tsx with functional download button. Typecheck passes."
    },
    {
      "id": "US-020",
      "title": "Download quiz come PDF",
      "description": "Come studente, voglio scaricare il quiz in formato PDF.",
      "acceptanceCriteria": [
        "Pulsante 'Scarica Quiz' nella pagina risultati",
        "PDF include: domande numerate con opzioni",
        "Risposte corrette in sezione separata a fine documento",
        "Nome file: quiz-[titolo]-[data].pdf",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 20,
      "passes": true,
      "notes": "Completed: Added generateQuizPdf function to lib/pdf-generator.ts. PDF includes: title 'Quiz di Verifica', summary title, creation date, numbered questions with type indicator (Scelta multipla/Vero-Falso), options with A/B/C/D labels for multiple choice or Vero/Falso circles for true/false. Answers section on separate page at end with correct answers and explanations. Footer shows 'Generato con Riassu.mi - Pagina X di Y'. File named quiz-[sanitized-title]-[date].pdf. Added 'Scarica Quiz' button with download icon to quiz results page. Typecheck passes."
    },
    {
      "id": "US-021",
      "title": "Form registrazione utente",
      "description": "Come studente, voglio creare un account per salvare i miei riassunti.",
      "acceptanceCriteria": [
        "Creare pagina /register con form",
        "Campi: email, password, conferma password",
        "Validazione: email formato valido, password min 8 caratteri, password corrispondono",
        "Hash password con bcrypt prima di salvare",
        "Redirect a /login dopo registrazione",
        "Messaggio errore se email giÃ  esistente",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 21,
      "passes": true,
      "notes": "Completed: Created /register page with registration form. Installed bcrypt for password hashing. API route at /api/auth/register validates email format, password length (min 8 chars), checks for duplicate emails (409 error), hashes password with bcrypt (10 rounds), and creates user in database. Client-side form has real-time validation for email format, password length, and password confirmation match. Loading state with spinner during submission. Redirects to /login?registered=true on success. Italian error messages throughout. Responsive design with dark mode support. Typecheck passes."
    },
    {
      "id": "US-022",
      "title": "Form login e gestione sessione",
      "description": "Come studente registrato, voglio accedere al mio account.",
      "acceptanceCriteria": [
        "Creare pagina /login con form email + password",
        "Verifica credenziali con bcrypt.compare()",
        "Creare sessione con cookie HTTP-only (no localStorage)",
        "Cookie contiene user ID firmato con secret da env",
        "Redirect a /dashboard dopo login",
        "Messaggio errore per credenziali errate",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 22,
      "passes": true,
      "notes": "Completed: Created /login page with email+password form. Created lib/auth.ts with session management using HMAC-SHA256 signed HTTP-only cookies. Cookie contains user ID and timestamp, signed with SESSION_SECRET or ENCRYPTION_KEY from env. Session expiry is 7 days. API route at /api/auth/login verifies credentials with bcrypt.compare(). Returns 401 with generic 'Credenziali non valide' message for security (prevents email enumeration). Redirects to /dashboard on success. Shows success message when coming from registration (?registered=true). Client-side validation for email format. Loading state with spinner during API call. Dark mode support. Typecheck passes."
    },
    {
      "id": "US-023",
      "title": "Middleware autenticazione",
      "description": "Come sviluppatore, ho bisogno di proteggere le route che richiedono login.",
      "acceptanceCriteria": [
        "Creare middleware.ts che verifica cookie sessione",
        "Funzione getSession() in lib/auth.ts che ritorna user o null",
        "Route /dashboard protetta: redirect a /login se non autenticato",
        "Route /upload accessibile a tutti (guest e logged)",
        "Typecheck passa"
      ],
      "priority": 23,
      "passes": true,
      "notes": "Completed: Created middleware.ts using Edge-compatible Web Crypto API for session verification. Protected routes (/dashboard) redirect to /login with redirect query param if not authenticated. Public routes (/, /upload, /login, /register, /summary, /quiz) are accessible to all. Middleware verifies HMAC-SHA256 signed session tokens and checks expiry. Invalid/expired sessions are cleared. getSession() was already implemented in lib/auth.ts (US-022). Typecheck passes."
    },
    {
      "id": "US-024",
      "title": "Associare riassunti all'utente loggato",
      "description": "Come sviluppatore, ho bisogno di collegare i riassunti all'utente se loggato.",
      "acceptanceCriteria": [
        "Modificare API /api/summarize per leggere sessione",
        "Se utente loggato: salvare user_id nel Summary",
        "Se guest: user_id rimane null",
        "Typecheck passa"
      ],
      "priority": 24,
      "passes": true,
      "notes": "Completed: Modified app/api/summarize/route.ts to import getSession from lib/auth. API now calls getSession() to retrieve current user session. If user is logged in, their ID is saved as user_id in the Summary record. If guest (no session), user_id remains null. Typecheck passes."
    },
    {
      "id": "US-025",
      "title": "Dashboard utente con storico",
      "description": "Come studente loggato, voglio vedere tutti i miei riassunti passati.",
      "acceptanceCriteria": [
        "Creare pagina /dashboard",
        "Lista card con: titolo PDF, data creazione, livello dettaglio",
        "Ordinamento per data decrescente",
        "Click su card apre /summary/[id]",
        "Messaggio 'Nessun riassunto' se lista vuota",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 25,
      "passes": true,
      "notes": "Completed: Created /dashboard page as server component. Fetches user summaries from database using getSession() for auth. Displays summary cards with title, PDF name, detail level (Italian labels), and creation date. Summaries ordered by created_at descending. Click on card navigates to /summary/[id]. Empty state shows 'Nessun riassunto' message with icon and CTA to upload first PDF. 'Carica nuovo PDF' button at top. Responsive design with dark mode support. Route already protected by middleware (US-023). Typecheck passes."
    },
    {
      "id": "US-026",
      "title": "Eliminazione riassunto",
      "description": "Come studente, voglio poter eliminare un riassunto dalla mia dashboard.",
      "acceptanceCriteria": [
        "Pulsante 'Elimina' su ogni card nella dashboard",
        "Modal di conferma: 'Sei sicuro? Questa azione eliminerÃ  anche il quiz associato'",
        "API DELETE /api/summary/[id] che elimina Summary e Quiz collegato",
        "Verifica che l'utente sia proprietario del riassunto",
        "Aggiornamento lista dopo eliminazione",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 26,
      "passes": true,
      "notes": "Completed: Created DELETE API route at /api/summary/[id] that verifies user authentication and ownership before deleting. Returns 401 for unauthenticated, 403 for non-owner, 404 for not found. Quizzes are cascade deleted via Prisma schema. Created SummaryList client component with delete button (trash icon) on each card and confirmation modal. Modal shows warning about quiz deletion. List updates immediately after successful deletion and calls router.refresh(). Typecheck passes."
    },
    {
      "id": "US-027",
      "title": "Header con navigazione e stato auth",
      "description": "Come utente, voglio un header che mostri navigazione e stato login.",
      "acceptanceCriteria": [
        "Creare components/header.tsx",
        "Logo 'Riassu.mi' che linka a homepage",
        "Se guest: pulsanti 'Accedi' e 'Registrati'",
        "Se loggato: link 'Dashboard' e pulsante 'Esci'",
        "Logout cancella cookie e redirect a homepage",
        "Header presente in tutte le pagine (layout)",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 27,
      "passes": true,
      "notes": "Completed: Created components/header.tsx with responsive navigation. Logo 'Riassu.mi' links to homepage. Guest users see 'Accedi' and 'Registrati' buttons. Logged-in users see 'Dashboard' link and 'Esci' button. Created /api/auth/logout endpoint that calls destroySession() and redirects to homepage. Header added to layout.tsx via HeaderWrapper server component that fetches session data. Header present on all pages. Responsive design with dark mode support. Typecheck passes."
    },
    {
      "id": "US-028",
      "title": "Pagina admin gestione API key",
      "description": "Come admin, voglio poter aggiungere e rimuovere API key OpenRouter.",
      "acceptanceCriteria": [
        "Creare pagina /admin/api-keys (protetta, accessibile solo se ADMIN_EMAIL in env)",
        "Form per aggiungere nuova API key",
        "Lista key esistenti con: ultimi 4 caratteri, stato (attiva/disabilitata), fail_count",
        "Pulsante per eliminare key",
        "Pulsante per riattivare key disabilitata",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 28,
      "passes": true,
      "notes": "Completed: Created /admin/api-keys page protected by ADMIN_EMAIL environment variable. Server component verifies session and checks if user email matches ADMIN_EMAIL. Shows configuration error if ADMIN_EMAIL not set, access denied if user is not admin. API routes created at /api/admin/api-keys (GET for list, POST for add) and /api/admin/api-keys/[id] (DELETE for remove, PATCH for reactivate/deactivate). Client component displays keys with last 4 chars masked, status badges (Attiva/Disattivata/Temp. disabilitata), fail_count, last_used date, disabled_until. Add form with password input type for security. Delete confirmation modal. Reactivate/deactivate toggle button. Middleware updated to protect /admin routes. ADMIN_EMAIL added to .env as commented example. Typecheck passes."
    },
    {
      "id": "US-029",
      "title": "Toast notifications",
      "description": "Come utente, voglio vedere notifiche per successo ed errori.",
      "acceptanceCriteria": [
        "Creare components/toast.tsx e context ToastProvider",
        "Funzione toast.success(message) e toast.error(message)",
        "Toast appare in alto a destra, scompare dopo 4 secondi",
        "Colore verde per success, rosso per error",
        "Usare toast per: upload completato, errore API, login/logout",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 29,
      "passes": false,
      "notes": ""
    },
    {
      "id": "US-030",
      "title": "Gestione errori e pagina 404",
      "description": "Come utente, voglio messaggi di errore chiari e una pagina 404.",
      "acceptanceCriteria": [
        "Creare app/not-found.tsx con design coerente",
        "Messaggio 'Pagina non trovata' con link a homepage",
        "Error boundary per errori React con messaggio user-friendly",
        "API errors ritornano JSON { error: 'messaggio leggibile' }",
        "Mai mostrare stack trace all'utente",
        "Typecheck passa",
        "Verify in browser using dev-browser skill"
      ],
      "priority": 30,
      "passes": false,
      "notes": ""
    }
  ]
}
