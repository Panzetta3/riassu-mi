## 2026-01-25 - US-001: Setup progetto Next.js

### What was done:
- Initialized Next.js 16.1.4 project with App Router
- Configured TypeScript 5
- Configured Tailwind CSS 4
- Created folder structure: app/, components/, lib/, types/
- Added npm scripts: typecheck, test
- Typecheck passes successfully

### Files created/modified:
- package.json (renamed to "riassumi", added typecheck and test scripts)
- app/ (layout.tsx, page.tsx, globals.css, favicon.ico)
- components/.gitkeep
- lib/.gitkeep
- types/.gitkeep
- tsconfig.json
- next.config.ts
- postcss.config.mjs
- eslint.config.mjs
- .gitignore

### Notes for next developer:
- The project is ready for feature development
- Next priority is US-002: Setup Prisma with base schema
- Run `npm run dev` to start development server
- Run `npm run typecheck` to check types

---

## 2026-01-25 - US-002: Setup Prisma con schema base

### What was done:
- Installed Prisma 7.3.0 and @prisma/client
- Configured SQLite with better-sqlite3 adapter (required for Prisma 7)
- Created all database models:
  - User: id, email, password_hash, created_at, summaries relation
  - Summary: id, user_id (nullable), title, content, detail_level, pdf_name, created_at, quizzes relation
  - Quiz: id, summary_id, questions (JSON as string), created_at
  - ApiKey: id, key_encrypted, provider, is_active, last_used, fail_count, disabled_until
- Ran initial migration successfully
- Generated Prisma client to lib/generated/prisma/
- Created lib/prisma.ts singleton for database access
- Typecheck passes successfully

### Files created/modified:
- package.json (added prisma, @prisma/client, @prisma/adapter-better-sqlite3, better-sqlite3, dotenv)
- prisma/schema.prisma (database schema)
- prisma/migrations/20260125113815_init/migration.sql (initial migration)
- prisma/dev.db (SQLite database file)
- prisma.config.ts (Prisma configuration)
- lib/prisma.ts (Prisma client singleton)
- lib/generated/prisma/ (generated Prisma client)
- .env (DATABASE_URL configuration)

### Notes for next developer:
- Use `import { prisma } from '@/lib/prisma'` to access the database
- Prisma 7 uses a new configuration approach - see prisma.config.ts
- The SQLite database file is at prisma/dev.db
- Run `npx prisma studio` to view/edit data
- Run `npx prisma migrate dev` to apply schema changes
- Next priority is US-003: Servizio gestione API key con failover

---

## 2026-01-25 - US-003: Servizio gestione API key con failover

### What was done:
- Created lib/api-keys.ts with complete API key management service
- Implemented AES-256-GCM encryption/decryption for secure key storage
- Functions implemented:
  - `encryptKey(plainKey)` - Encrypts API key with AES-256-GCM
  - `decryptKey(encryptedData)` - Decrypts stored API key
  - `getActiveKey()` - Returns first active, non-disabled key (decrypted)
  - `getActiveKeyWithId()` - Returns key with ID for tracking success/failure
  - `markKeyFailed(keyId)` - Increments fail_count, disables for 1 hour if > 5 failures
  - `markKeySuccess(keyId)` - Resets fail_count and clears disabled_until
  - `addApiKey(plainKey, provider)` - Adds new encrypted API key to database
  - `deactivateKey(keyId)` - Soft deletes a key
  - `reactivateKey(keyId)` - Reactivates a disabled/deactivated key
- Encryption key is read from ENCRYPTION_KEY environment variable
- Added ENCRYPTION_KEY to .env file (with placeholder value)
- Typecheck passes successfully

### Files created/modified:
- lib/api-keys.ts (new - API key management service)
- .env (added ENCRYPTION_KEY variable)

### Notes for next developer:
- Import API key functions: `import { getActiveKey, markKeyFailed, markKeySuccess } from '@/lib/api-keys'`
- For failover pattern: use `getActiveKeyWithId()`, then `markKeyFailed(id)` or `markKeySuccess(id)`
- Keys are automatically load-balanced (least recently used first)
- IMPORTANT: Change ENCRYPTION_KEY in production to a strong random value
- Use `addApiKey(key, 'openrouter')` to add new API keys to the database
- Next priority is US-004: Componenti UI base

---

## 2026-01-25 - US-004: Componenti UI base

### What was done:
- Created components/ui/ directory with reusable UI components
- Created Button component with 3 variants: primary, secondary, ghost
- Created Card component with CardHeader, CardContent, CardFooter subcomponents
- Created Input component with label and error state support
- Created Select component with label, error state, and custom dropdown arrow
- Created Spinner component with sm/md/lg size variants
- Created index.tsx for easy component imports
- All components use Tailwind CSS for styling
- All components typed with TypeScript and use forwardRef for ref forwarding
- Supports dark mode via Tailwind dark: variants
- Typecheck passes successfully

### Files created/modified:
- components/ui/button.tsx (new - Button with primary/secondary/ghost variants)
- components/ui/card.tsx (new - Card, CardHeader, CardContent, CardFooter)
- components/ui/input.tsx (new - Input with label and error support)
- components/ui/select.tsx (new - Select dropdown with options)
- components/ui/spinner.tsx (new - Loading spinner with size variants)
- components/ui/index.tsx (new - barrel export for all components)

### Notes for next developer:
- Import components: `import { Button, Card, Input, Select, Spinner } from '@/components/ui'`
- Button variants: `<Button variant="primary|secondary|ghost">...</Button>`
- Card example: `<Card><CardHeader>Title</CardHeader><CardContent>Body</CardContent></Card>`
- Input with error: `<Input label="Email" error="Invalid email" />`
- Select usage: `<Select options={[{value: 'a', label: 'A'}]} label="Choose" />`
- Spinner sizes: `<Spinner size="sm|md|lg" />`
- Next priority is US-005: Homepage con hero section

---

## 2026-01-25 - US-005: Homepage con hero section

### What was done:
- Created responsive homepage with hero section
- Hero section features "Riassu.mi" title with accent color on ".mi"
- Added brief description explaining the AI-powered PDF summarization
- CTA button "Carica PDF" links to /upload
- "Come funziona" section with 3 steps: Carica, Riassumi, Quiz
- Each step has an icon, title, and description
- Mobile-first responsive design using Tailwind CSS
- Dark mode support throughout
- Updated app metadata (title and description)
- Added simple footer with copyright
- Typecheck passes successfully

### Files created/modified:
- app/page.tsx (complete rewrite - homepage with hero and steps)
- app/layout.tsx (updated metadata for app branding)

### Notes for next developer:
- Homepage uses the Button component from @/components/ui
- Design uses gradient background from blue-50 to white
- Responsive breakpoints: default (mobile), sm:, md:
- The /upload route is not yet created - that's US-006
- Next priority is US-006: Upload PDF con drag & drop

---

## 2026-01-25 - US-006: Upload PDF con drag & drop

### What was done:
- Created /upload page with file upload functionality
- Created FileUpload component with drag & drop support
- Features implemented:
  - Drag & drop with visual feedback (border color change, background change)
  - Click to select file via hidden input
  - Validation for .pdf extension and application/pdf MIME type
  - 20MB file size limit
  - Displays file name and formatted file size after selection
  - Error messages for invalid files (wrong format, size exceeded)
  - "Rimuovi file" button to clear selection
  - "Genera Riassunto" button appears when file is valid
- Mobile-first responsive design with Tailwind CSS
- Dark mode support throughout
- Back link to homepage
- Typecheck passes successfully

### Files created/modified:
- components/file-upload.tsx (new - FileUpload component with drag & drop)
- app/upload/page.tsx (new - upload page with validation logic)

### Notes for next developer:
- FileUpload is a reusable component: `import { FileUpload } from '@/components/file-upload'`
- MAX_FILE_SIZE constant exported from file-upload.tsx (20MB)
- formatFileSize utility function also exported
- The "Genera Riassunto" button doesn't have functionality yet - that's US-012
- Next priority is US-007: Estrazione testo da PDF
